# –í–µ—Ä—Å–∏—è 4.1. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –∏ —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–∞—Ç–∞–ª–æ–≥–æ–≤.
# –ü–∞–ø–∫–∏ –º–µ–Ω—å—à–µ 99 –º–± –ù–ï —Å–∫–∞–Ω–∏—Ä—É—é—Ç—Å—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –∏ –Ω–µ –≤—ã–≤–æ–¥—è—Ç—Å—è.
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω 1 –ø—Ä–æ—Ö–æ–¥ –ø–æ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω Dictionary –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å –∫—ç—à–µ–º.
# –ü–æ —Ç–µ—Å—Ç–∞–º, –≤–µ—Ä—Å–∏—è 4.1 –≤—ã–¥–∞—ë—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ 15 —Å–µ–∫. –ø—Ä–æ—Ç–∏–≤ 25-–∏ —É –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö.
# –¢–∞–∫–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∫—Ä—ã—Ç—ã–µ –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞–ø–∫–∏.

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–∞–ø–∫—É, –≥–¥–µ –ª–µ–∂–∏—Ç —Å–∫—Ä–∏–ø—Ç.
if ($PSScriptRoot) {
    $RootPath = $PSScriptRoot
} else {
    $RootPath = (Get-Location).Path
}

# –ü–æ—Ä–æ–≥–∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∏.
$MinVisibleSize = 99MB # –ù–µ –≤—ã–≤–æ–¥–∏—Ç—å –ø–∞–ø–∫–∏, —Ä–∞–∑–º–µ—Ä –∫–æ—Ç–æ—Ä—ã—Ö –º–µ–Ω—å—à–µ 99 –º–±.
$YellowLimit    = 100MB # –ü–∞–ø–∫–∏ >= 100 –º–± –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—é—Ç—Å—è –∂—ë–ª—Ç—ã–º.
$GreenLimit       = 1GB # –ü–∞–ø–∫–∏ >= 1 –≥–± –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—é—Ç—Å—è –∑–µ–ª—ë–Ω—ã–º.

# –ò—Å–ø–æ–ª—å–∑—É–µ–º –±—ã—Å—Ç—Ä—ã–π Dictionary –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω–æ–≥–æ —Ö–µ—à–∞.
# $FolderSizeCache = @{} <--- –±—ã–ª–æ, c—Ç–∞–ª–æ:
$FolderSizeCache = [System.Collections.Generic.Dictionary[string,long]]::new()

# === –û–¥–∏–Ω –ø—Ä–æ—Ö–æ–¥ –ø–æ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∫—ç—à–∞ ===
# –î–æ–±–∞–≤–ª–µ–Ω -Force, —á—Ç–æ–±—ã —É—á–∏—Ç—ã–≤–∞—Ç—å —Å–∫—Ä—ã—Ç—ã–µ –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã
Get-ChildItem -Path $RootPath -Recurse -File -Force -ErrorAction SilentlyContinue | ForEach-Object {
    $fileSize = $_.Length
    $dir = $_.DirectoryName

    while ($dir -and $dir.StartsWith($RootPath, [System.StringComparison]::OrdinalIgnoreCase)) {
        if (-not $FolderSizeCache.ContainsKey($dir)) {
            $FolderSizeCache[$dir] = 0
        }
        $FolderSizeCache[$dir] += $fileSize
        $dir = Split-Path $dir -Parent
    }
}

# –ü–æ–ª—É—á–∞–µ–º –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä –ø–∞–ø–∫–∏ –≤ –±–∞–π—Ç–∞—Ö, –∏—Å–ø–æ–ª—å–∑—É—è $FolderSizeCache.
# –ï—Å–ª–∏ –ø–∞–ø–∫–∞ –ø—É—Å—Ç–∞—è, –∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0.
function Get-FolderSize {
    param ($Path)
    if ($FolderSizeCache.ContainsKey($Path)) {
        return $FolderSizeCache[$Path]
    }
    return 0
}

# –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã–≤–æ–¥–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª—å —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Ä–∞–∑–º–µ—Ä–∞.
# –ü–∞–ø–∫–∏ –º–µ–Ω—å—à–µ $MinVisibleSize –Ω–µ –≤—ã–≤–æ–¥—è—Ç—Å—è –∏ –Ω–µ —Å–∫–∞–Ω–∏—Ä—É—é—Ç—Å—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ.
function Show-Tree {
    param (
        [string]$Path,
        [string]$Indent = ""
    )

    # –ò—Å–ø–æ–ª—å–∑—É–µ–º Get-FolderSize –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –ø–∞–ø–æ–∫ –∏–∑ –∫—ç—à–∞.
    $size = Get-FolderSize $Path

    # –ù–µ –≤—ã–≤–æ–¥–∏–º –∏ –Ω–µ —Å–∫–∞–Ω–∏—Ä—É–µ–º –ø–∞–ø–∫–∏ –º–µ–Ω—å—à–µ 99 –º–±.
    if ($size -lt $MinVisibleSize) {
        return
    }

    # $size - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø–∞–ø–∫–∏ –≤ –±–∞–π—Ç–∞—Ö (—Å—É–º–º–∞ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ
    # –∏ –µ—ë –ø–æ–¥–ø–∞–ø–∫–∞—Ö).
    # 1MB - –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –º–µ–≥–∞–±–∞–π—Ç–∞ –≤ –±–∞–π—Ç–∞—Ö.
    # –î–µ–ª–µ–Ω–∏–µ $size / 1MB - –ø–µ—Ä–µ–≤–æ–¥ –±–∞–π—Ç –≤ –º–µ–≥–∞–±–∞–π—Ç—ã.
    $sizeMB = [math]::Round($size / 1MB, 2)

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –≤—ã–≤–æ–¥–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–∞–ø–∫–∏.
    if ($size -ge $GreenLimit) {
        $color = "Green"   # –¶–≤–µ—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø–∞–ø–æ–∫ - –∑–µ–ª—ë–Ω—ã–π.
    }
    elseif ($size -ge $YellowLimit) {
        $color = "Yellow"    # –ñ—ë–ª—Ç—ã–π —Ü–≤–µ—Ç –¥–ª—è –ø–∞–ø–æ–∫ –æ—Ç 100+ –º–±.
    }
    else {
        $color = "White"     # –ë–µ–ª—ã–π —Ü–≤–µ—Ç –¥–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö.
    }

    Write-Host "$IndentüìÇ $(Split-Path $Path -Leaf) [$sizeMB MB]" -ForegroundColor $color

    # –ü–æ–ª—É—á–∞–µ–º –ø–æ–¥–ø–∞–ø–∫–∏.
    # –î–æ–±–∞–≤–ª–µ–Ω -Force, —á—Ç–æ–±—ã —É—á–∏—Ç—ã–≤–∞—Ç—å —Å–∫—Ä—ã—Ç—ã–µ –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞–ø–∫–∏
    $dirs = Get-ChildItem -Path $Path -Directory -Force -ErrorAction SilentlyContinue

    foreach ($dir in $dirs) {
        # –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Å–∫–∞–Ω–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –ø–∞–ø–∫–∏ >= 99 –º–±.
        $subSize = Get-FolderSize $dir.FullName
        if ($subSize -ge $MinVisibleSize) {
            Show-Tree -Path $dir.FullName -Indent "$Indent¬¶  "
        }
    }
}

Write-Host "üìÇ Root: $RootPath" -ForegroundColor Cyan
Show-Tree $RootPath